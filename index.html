<!DOCTYPE html>
<html>
<head>
    <title>Lexa - Legal XML Translator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --bg-1: #f8fafc;
            --bg-2: #f1f5f9;
            --panel-bg: #ffffff;
            --panel-shadow: 0 8px 25px rgba(15, 23, 42, 0.08);
            --text: #0f172a;         /* Slate-900 */
            --text-secondary: #334155; /* Slate-700 */
            --muted: #64748b;        /* Slate-500 */
            --border: #e2e8f0;       /* Slate-200 */
            --accent: #2563eb;       /* Blue-600 */
            --accent-hover: #1d4ed8; /* Blue-700 */
            --accent-light: #dbeafe; /* Blue-100 */
            --danger: #dc2626;       /* Red-600 */
            --success: #16a34a;      /* Green-600 */
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
            color: var(--text);
            background: linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .header { 
            text-align: center; 
            margin-bottom: 20px; 
            color: var(--text); 
            padding: 10px 0;
        }
        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 5px 0;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }
        .header p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 400;
        }
        .container { 
            display: flex; 
            gap: 20px; 
            align-items: flex-start; 
            background: var(--panel-bg); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: var(--panel-shadow); 
            border: 1px solid var(--border);
        }
        .input-section { flex: 1.2; }
        .output-section { flex: 1; }
        .input-split { display: flex; flex-direction: column; gap: 10px; }
        .sub-section { flex: 1; }
        .sub-title { 
            font-size: 0.875rem; 
            font-weight: 600; 
            margin-bottom: 8px; 
            color: var(--muted); 
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .section-title { 
            font-size: 1.25rem; 
            font-weight: 600; 
            margin-bottom: 12px; 
            color: var(--text); 
            letter-spacing: -0.025em;
        }
        /* Keep Output title aligned with Input, but lower the panel */
        .output-section { /* no top margin so title aligns with Input */ }
        .output-section .section-title { margin-top: 0px; }
        .output-panel { margin-top: 50px; }
        .output-render { width: calc(100% - 8px); height: 220px; border: 1px solid var(--border); border-radius: 8px; padding: 10px; font-family: monospace; font-size: 14px; overflow: auto; white-space: pre-wrap; line-height: 1.4; background: #fff; box-sizing: border-box; margin-right: 8px; }
        .prompt-panel { 
            margin: 16px 0 0 0; 
            padding: 8px; 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            background: var(--accent-light);
            box-shadow: 0 2px 4px rgba(15, 23, 42, 0.04);
        }
        .prompt-panel .prompt-label { 
            font-size: 0.8125rem; 
            color: var(--text-secondary); 
            margin-bottom: 6px; 
            font-weight: 600; 
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .prompt-panel textarea { height: 48px; font-family: monospace; font-size: 13px; box-sizing: border-box; width: 100%; }
        .actions { margin-top: 8px; }
        textarea { 
            width: 100%; 
            height: 220px; 
            border: 1px solid var(--border); 
            border-radius: 8px; 
            padding: 12px; 
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; 
            font-size: 14px; 
            line-height: 1.5;
            resize: vertical; 
            background: #fff; 
            color: var(--text); 
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }
        textarea:focus { 
            outline: none;
            border-color: var(--accent); 
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .sub-section textarea { height: 100px; }
        button { 
            padding: 12px 24px; 
            margin: 12px 8px 0 0; 
            background: var(--accent); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 500;
            transition: all 0.15s ease; 
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }
        button:hover { 
            background: var(--accent-hover); 
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.25);
        }
        button:active { transform: translateY(1px); }
        button:disabled { background-color: #9aa4b2; cursor: not-allowed; }
        .loading { color: var(--muted); font-style: italic; }
        .error { color: var(--danger); background-color: #fde2e4; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid #fecdd3; }
        .missing-elements { color: var(--danger); font-weight: bold; }
        .summary-correct { color: var(--success); font-weight: bold; }
        .summary-issues { color: var(--danger); font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>LEXA - Legal XML Auditor</h1>
        <p>Evaluate accuracy between legal statutes and XML representations</p>
    </div>

    <div class="container">
        <div class="input-section">
            <div class="section-title">Input</div>
            <div class="input-split">
                <div class="sub-section">
                    <div class="sub-title">Legal Code</div>
                    <textarea id="legalText" placeholder="Enter legal statute text here...">2024 Maryland Statutes Labor and Employment Title 8 - Unemployment Insurance Subtitle 10 - Disqualification Section 8-1009 - Severance Pay Universal Citation: MD Labor and Employment Code § 8-1009 (2024) Learn more Previous (a) (1) For each week that the Secretary finds an individual who otherwise is eligible for benefits receives or is eligible to receive dismissal payment or wages in lieu of notice, regardless of whether the payment is required by law: (i) if the payment at least equals the individual's weekly benefit amount, the individual is disqualified from receiving benefits; or (ii) if the payment is less than the individual's weekly benefit amount, the individual may receive benefits reduced by the amount of the payment. (2) Dismissal payment or wages in lieu of notice shall be allocated to a number of weeks following separation from employment that equals the number of weeks of wages received. (b) An individual who is otherwise eligible for benefits, including benefits payable under the Unemployment Compensation for Ex–Service Members Program in accordance with 5 U.S.C. § 8521 may receive benefits, and the benefits may not be reduced under subsection (a)(2) of this section, for each week that the Secretary finds that the individual receives or is eligible to receive military disability severance payments.</textarea>
                </div>
                <div class="sub-section">
                    <div class="sub-title">XML</div>
                    <textarea id="xmlText" placeholder="Enter XML representation here..."><statute id="MD-LE-8-1009-2024">
  <jurisdiction>Maryland</jurisdiction>
  <codeTitle>Labor and Employment</codeTitle>
  <title number="8">Unemployment Insurance</title>
  <subtitle number="10">Disqualification</subtitle>
  <section number="8-1009">
    <sectionHeading>Severance Pay</sectionHeading>
    <universalCitation>MD Labor and Employment Code § 8-1009 (2024)</universalCitation>

    <provision num="a">
      <subProvision num="1">
        <rule type="dismissal-payment">
          <statement>
            For each week that the Secretary finds an individual who otherwise is eligible for benefits 
            receives or is eligible to receive dismissal payment or wages in lieu of notice, regardless of 
            whether the payment is required by law:
          </statement>
          <condition num="i">
            If the payment at least equals the individual's weekly benefit amount,
            <outcome type="disqualification">the individual is disqualified from receiving benefits</outcome>.
          </condition>
          <condition num="ii">
            If the payment is more than the individual's weekly benefit amount,
            <outcome type="reduction">the individual may receive benefits reduced by the amount of the payment</outcome>.
          </condition>
        </rule>
      </subProvision>
      <subProvision num="2">
        <rule type="allocation">
          <statement>
            Dismissal payment or wages in lieu of notice shall be allocated to a number of weeks following
            separation from employment that equals the number of weeks of wages received.
          </statement>
        </rule>
      </subProvision>
    </provision>

    <provision num="b">
      <rule type="military-disability-severance">
        <statement>
          An individual who is otherwise eligible for benefits, including benefits payable under the 
          Unemployment Compensation for Ex–Service Members Program in accordance with 5 U.S.C. § 8521,
          may receive benefits, and the benefits may not be reduced under subsection (a)(2) of this section,
          for each week that the Secretary finds that the individual receives or is eligible to receive 
          military disability severance payments.
        </statement>
      </rule>
    </provision>
  </section>
</statute></textarea>
                </div>
            </div>
        </div>
        <div class="output-section">
            <div class="section-title">Output</div>
            <div class="output-panel">
                <div id="outputRender" class="output-render" style="display:none;"></div>
                <textarea id="outputText" readonly placeholder="Evaluation results will appear here..."></textarea>
                <div id="errorDiv"></div>
            </div>
        </div>
    </div>

    <div class="prompt-panel">
        <div class="prompt-label">Evaluation Prompt (optional)</div>
        <textarea id="promptText" placeholder="Add specific guidance to refine the evaluation...">Be concise. Evaluate semantic fidelity only; ignore formatting-only differences unless meaning changes.</textarea>
    </div>

    <div class="actions">
        <button id="evaluateBtn" onclick="translateToXML()">Evaluate</button>
        <button id="clearBtn" onclick="clearInputs()">Clear</button>
    </div>

    <script>
        async function translate(direction) {
            const legalText = document.getElementById('legalText').value;
            const xmlText = document.getElementById('xmlText').value;
            const inputText = legalText.trim() + '\n\n' + xmlText.trim();
            const promptTextEl = document.getElementById('promptText');
            const promptOverride = promptTextEl ? promptTextEl.value.trim() : '';
            const outputText = document.getElementById('outputText');
            const errorDiv = document.getElementById('errorDiv');
            const buttons = document.querySelectorAll('button');

            errorDiv.innerHTML = '';
            if (!legalText.trim() || !xmlText.trim()) { showError('Please enter both legal text and XML code'); return; }

            outputText.value = 'Evaluating...';
            outputText.className = 'loading';
            buttons.forEach(btn => btn.disabled = true);

            try {
                const API_BASE_URL = window.location.hostname === 'afane.github.io'
                    ? 'https://lexa-production.up.railway.app'
                    : '';

                const response = await fetch(`${API_BASE_URL}/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: inputText, direction, prompt: promptOverride || null })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || 'Translation failed');

                const result = data.result;
                outputText.value = result;
                outputText.className = '';

                // Highlight Summary section only and render at TOP in fixed-height box
                const outputRender = document.getElementById('outputRender');
                let rendered = result;
                const summaryMatch = result.match(/Summary:[\s\S]*$/i);
                if (summaryMatch) {
                    const summaryText = summaryMatch[0];
                    const after = summaryText.replace(/^[ \t]*Summary:\s*/i, '').trim();
                    let wrapClass = 'summary-issues';
                    if (/^accurate\b/i.test(after)) {
                        wrapClass = 'summary-correct';
                    } else if (/^not\b/i.test(after)) {
                        wrapClass = 'summary-issues';
                    }
                    const rest = result.replace(/Summary:[\s\S]*$/i, '').trimEnd();
                    const coloredSummary = `<div class="${wrapClass}">${summaryText}</div>`;
                    rendered = `${coloredSummary}\n\n${rest}`;
                }

                outputRender.innerHTML = rendered;
                outputRender.style.display = 'block';
                outputText.style.display = 'none';
            } catch (error) {
                outputText.value = '';
                showError('Translation failed: ' + error.message);
            } finally {
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        function translateToXML() { translate('legal_to_xml'); }

        function clearInputs() {
            document.getElementById('legalText').value = '';
            document.getElementById('xmlText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('errorDiv').innerHTML = '';
            
            // Ensure output textarea is visible and render box hidden
            document.getElementById('outputText').style.display = 'block';
            const renderEl = document.getElementById('outputRender');
            if (renderEl) renderEl.style.display = 'none';
        }
    </script>
</body>
</html>
