<!DOCTYPE html>
<html>
<head>
    <title>Lexa - Legal XML Translator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .header { text-align: center; margin-bottom: 30px; color: #333; }
        .container { display: flex; gap: 20px; align-items: flex-start; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-section { flex: 1.2; }
        .output-section { flex: 1; }
        .input-split { display: flex; flex-direction: column; gap: 10px; }
        .sub-section { flex: 1; }
        .sub-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; color: #666; }
        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #444; }
        /* Keep Output title aligned with Input, but lower the panel */
        .output-section { /* no top margin so title aligns with Input */ }
        .output-section .section-title { margin-top: 0px; }
        .output-panel { margin-top: 50px; }
        .output-render { width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: monospace; font-size: 14px; overflow: auto; white-space: pre-wrap; line-height: 1.4; background: white; }
        .prompt-panel { margin: 16px 0 0 0; padding: 8px; border: 1px solid #e0e0e0; border-radius: 6px; background: #fafafa; }
        .prompt-panel .prompt-label { font-size: 12px; color: #666; margin-bottom: 6px; font-weight: bold; }
        .prompt-panel textarea { height: 56px; font-family: monospace; font-size: 13px; }
        .actions { margin-top: 10px; }
        textarea { width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: monospace; font-size: 14px; resize: vertical; }
        .sub-section textarea { height: 140px; }
        button { padding: 12px 24px; margin: 10px 5px 0 0; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        .loading { color: #666; font-style: italic; }
        .error { color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 4px; margin-top: 10px; }
        .missing-elements { color: #dc3545; font-weight: bold; }
        .summary-correct { color: #28a745; font-weight: bold; }
        .summary-issues { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>LEXA - Legal XML Auditor</h1>
        <p>Evaluate accuracy between legal statutes and XML representations</p>
    </div>

    <div class="container">
        <div class="input-section">
            <div class="section-title">Input</div>
            <div class="input-split">
                <div class="sub-section">
                    <div class="sub-title">Legal Code</div>
                    <textarea id="legalText" placeholder="Enter legal statute text here...">1253.9. An unemployed individual may not be disqualified for unemployment compensation benefits solely on the basis that he or she is a student. An unemployed individual may be considered to be able and available for work pursuant to subdivision (c) of Section 1253, if the school attendance does not eliminate a substantial portion of the individual's full-time labor market availability. If an unemployed individual restricts his or her availability to part-time work due to school attendance, he or she may be considered to be able to work and available for work if he or she meets the criteria set forth in Section 1253.8.</textarea>
                </div>
                <div class="sub-section">
                    <div class="sub-title">XML</div>
                    <textarea id="xmlText" placeholder="Enter XML representation here..."><statute id="1253.9"> <sectionHeading>Student unemployment compensation eligibility</sectionHeading> <provision num="1"> <rule type="non-disqualification"> <statement> An unemployed individual may not be disqualified for unemployment compensation benefits <condition type="solely">on the basis that he or she is a student</condition>. </statement> </rule> </provision> <provision num="2"> <rule type="eligibility_for_availability"> <statement> An unemployed individual may be considered to be able and available for work <pursuantTo> <citation ref="1253(c)">subdivision (c) of Section 1253</citation> </pursuantTo>, <condition type="if">the school attendance does not eliminate a substantial portion of the individual's full-time labor market availability</condition>. </statement> </rule> </provision> <provision num="3"> <rule type="conditional_eligibility_for_part_time_work"> <statement> <ifClause>If an unemployed individual restricts his or her availability to part-time work due to school attendance</ifClause>, <thenClause> he or she may be considered to be able to work and available for work <condition type="if">he or she meets the criteria set forth in <citation ref="1253.8">Section 1253.8</citation></condition>. </thenClause> </statement> </rule> </provision> </statute></textarea>
                </div>
            </div>
        </div>
        <div class="output-section">
            <div class="section-title">Output</div>
            <div class="output-panel">
                <div id="outputRender" class="output-render" style="display:none;"></div>
                <textarea id="outputText" readonly placeholder="Evaluation results will appear here..."></textarea>
                <div id="errorDiv"></div>
            </div>
        </div>
    </div>

    <div class="prompt-panel">
        <div class="prompt-label">Evaluation Prompt (optional)</div>
        <textarea id="promptText" placeholder="Add specific guidance to refine the evaluation...">Focus on semantic fidelity. Ignore purely presentational or organizational formatting differences (e.g., headings/titles, numbering, benign wrappers/attributes, whitespace) unless they introduce new text, change conditions/obligations, alter scope, or modify references/definitions. Only flag substantive discrepancies such as missing or extra legal content, incorrect citations, altered logical structure (if/then/except), or meaning changes.</textarea>
    </div>

    <div class="actions">
        <button id="evaluateBtn" onclick="translateToXML()">Evaluate</button>
        <button id="clearBtn" onclick="clearInputs()">Clear</button>
    </div>

    <script>
        async function translate(direction) {
            const legalText = document.getElementById('legalText').value;
            const xmlText = document.getElementById('xmlText').value;
            const inputText = legalText.trim() + '\n\n' + xmlText.trim();
            const promptTextEl = document.getElementById('promptText');
            const promptOverride = promptTextEl ? promptTextEl.value.trim() : '';
            const outputText = document.getElementById('outputText');
            const errorDiv = document.getElementById('errorDiv');
            const buttons = document.querySelectorAll('button');

            errorDiv.innerHTML = '';
            if (!legalText.trim() || !xmlText.trim()) { showError('Please enter both legal text and XML code'); return; }

            outputText.value = 'Evaluating...';
            outputText.className = 'loading';
            buttons.forEach(btn => btn.disabled = true);

            try {
                const API_BASE_URL = window.location.hostname === 'afane.github.io'
                    ? 'https://lexa-production.up.railway.app'
                    : '';

                const response = await fetch(`${API_BASE_URL}/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: inputText, direction, prompt: promptOverride || null })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || 'Translation failed');

                const result = data.result;
                outputText.value = result;
                outputText.className = '';

                // Highlight Summary section only and render in fixed-height box
                const outputRender = document.getElementById('outputRender');
                let rendered = result;
                const summaryMatch = result.match(/Summary:[\s\S]*$/i);
                if (summaryMatch) {
                    const summaryText = summaryMatch[0];
                    const isAccurate = /(^|\b)Accurate representation\b/i.test(summaryText) && !/Not\s+accurate\s+representation/i.test(summaryText);
                    const wrapClass = isAccurate ? 'summary-correct' : 'summary-issues';
                    const rest = result.replace(/Summary:[\s\S]*$/i, '').trimEnd();
                    const coloredSummary = `<div class="${wrapClass}">${summaryText}</div>`;
                    rendered = `${coloredSummary}\n\n${rest}`;
                }

                outputRender.innerHTML = rendered;
                outputRender.style.display = 'block';
                outputText.style.display = 'none';
            } catch (error) {
                outputText.value = '';
                showError('Translation failed: ' + error.message);
            } finally {
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        function translateToXML() { translate('legal_to_xml'); }

        function clearInputs() {
            document.getElementById('legalText').value = '';
            document.getElementById('xmlText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('errorDiv').innerHTML = '';
            
            // Ensure output textarea is visible and render box hidden
            document.getElementById('outputText').style.display = 'block';
            const renderEl = document.getElementById('outputRender');
            if (renderEl) renderEl.style.display = 'none';
        }
    </script>
</body>
</html>
