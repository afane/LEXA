<!DOCTYPE html>
<html>
<head>
    <title>LEXA - Legal XML Auditor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .container {
            display: flex;
            gap: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section { flex: 1; }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #444;
        }
        textarea {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        textarea[readonly] {
            background-color: #f8f9fa;
        }
        button {
            padding: 12px 24px;
            margin: 10px 5px 0 0;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .controls {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>LEXA - Legal XML Auditor</h1>
        <p>Evaluate fidelity of XML rules against statutory requirements</p>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-title">Legal Text</div>
            <textarea id="legalText" placeholder="Enter the statutory text here..."></textarea>
        </div>
        <div class="section">
            <div class="section-title">XML Implementation</div>
            <textarea id="xmlText" placeholder="Enter the XML implementation here..."></textarea>
        </div>
        <div class="section">
            <div class="section-title">Evaluation Report</div>
            <textarea id="evaluationReport" readonly placeholder="Evaluation results will appear here..."></textarea>
            <div id="errorDiv"></div>
        </div>
    </div>

    <div class="controls">
        <button id="evaluateBtn" onclick="evaluate()">Evaluate</button>
        <button onclick="clearAll()">Clear All</button>
    </div>

    <script>
        // Prefill data
        const LEGAL_TEXT_PREFILL = `253.9. An unemployed individual may not be disqualified for unemployment compensation 
benefits solely on the basis that he or she is a student. An unemployed individual may 
be considered to be able and available for work pursuant to subdivision (c) of Section 
1253, if the school attendance does not eliminate a substantial portion of the 
individualâ€™s full-time labor market availability. If an unemployed individual restricts
his or her availability to part-time work due to school attendance, he or she may be 
considered to be able to work and available for work if he or she meets the criteria 
set forth in Section 1253.8.`;

        const XML_PREFILL = `<statute id="1253.9"> <sectionHeading>Student unemployment compensation eligibility</sectionHeading> <provision num="1"> <rule type="non-disqualification"> <statement> An unemployed individual may not be disqualified for unemployment compensation benefits <condition type="solely">on the basis that he or she is a student</condition>. </statement> </rule> </provision> <provision num="2"> <rule type="eligibility_for_availability"> <statement> An unemployed individual may be considered to be able and available for work <pursuantTo> <citation ref="1253(c)">subdivision (c) of Section 1253</citation> </pursuantTo>, <condition type="if">the school attendance does not eliminate a substantial portion of the individual's full-time labor market availability</condition>. </statement> </rule> </provision> <provision num="3"> <rule type="conditional_eligibility_for_part_time_work"> <statement> <ifClause>If an unemployed individual restricts his or her availability to part-time work due to school attendance</ifClause>, <thenClause> he or she may be considered to be able to work and available for work <condition type="if">he or she meets the criteria set forth in <citation ref="1253.8">Section 1253.8</citation></condition>. </thenClause> </statement> </rule> </provision> </statute>`;

        // Initialize page with prefill data
        window.addEventListener('load', function() {
            document.getElementById('legalText').value = LEGAL_TEXT_PREFILL;
            document.getElementById('xmlText').value = XML_PREFILL;
        });

        async function evaluate() {
            const legalText = document.getElementById('legalText').value;
            const xmlText = document.getElementById('xmlText').value;
            const evaluationReport = document.getElementById('evaluationReport');
            const errorDiv = document.getElementById('errorDiv');
            const buttons = document.querySelectorAll('button');

            // Clear previous errors
            errorDiv.innerHTML = '';

            if (!legalText.trim() || !xmlText.trim()) {
                showError('Please enter both legal text and XML implementation');
                return;
            }

            // Show loading state
            evaluationReport.value = 'Evaluating...';
            evaluationReport.className = 'loading';
            buttons.forEach(btn => btn.disabled = true);

            try {
                // Use environment variable or default to localhost for development
                const API_BASE_URL = window.location.hostname === 'afane.github.io' 
                    ? 'https://lexa-production.up.railway.app'
                    : 'http://localhost:8080';
                
                const userMessage = `Legal Text:
${legalText}

XML Implementation:
${xmlText}

Task: Evaluate how well the XML implementation captures the statutory requirements. Analyze coverage, accuracy, completeness, and structure. Identify any gaps, misrepresentations, or improvements needed.`;
                
                const response = await fetch(`${API_BASE_URL}/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: userMessage,
                        direction: 'legal_to_xml'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'Evaluation failed');
                }

                evaluationReport.value = data.result;
                evaluationReport.className = '';
            } catch (error) {
                evaluationReport.value = '';
                showError('Evaluation failed: ' + error.message);
            } finally {
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        function clearAll() {
            document.getElementById('legalText').value = '';
            document.getElementById('xmlText').value = '';
            document.getElementById('evaluationReport').value = '';
            document.getElementById('errorDiv').innerHTML = '';
        }
    </script>
</body>
</html>
