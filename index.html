<!DOCTYPE html>
<html>
<head>
    <title>Lexa - Legal XML Translator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .header { text-align: center; margin-bottom: 30px; color: #333; }
        .container { display: flex; gap: 20px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-section { flex: 1.2; }
        .output-section { flex: 1; }
        .input-split { display: flex; flex-direction: column; gap: 10px; }
        .sub-section { flex: 1; }
        .sub-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; color: #666; }
        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #444; }
        .output-section { margin-top: 50px; }
        .output-section .section-title { margin-top: 0px; }
        textarea { width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: monospace; font-size: 14px; resize: vertical; }
        .sub-section textarea { height: 140px; }
        button { padding: 12px 24px; margin: 10px 5px 0 0; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        .loading { color: #666; font-style: italic; }
        .error { color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 4px; margin-top: 10px; }
        .missing-elements { color: #dc3545; font-weight: bold; }
        .summary-correct { color: #28a745; font-weight: bold; }
        .summary-issues { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>LEXA - Legal XML Auditor</h1>
        <p>Evaluate accuracy between legal statutes and XML representations</p>
    </div>

    <div class="container">
        <div class="input-section">
            <div class="section-title">Input</div>
            <div class="input-split">
                <div class="sub-section">
                    <div class="sub-title">Legal Code</div>
                    <textarea id="legalText" placeholder="Enter legal statute text here...">1253.9. An unemployed individual may not be disqualified for unemployment compensation benefits solely on the basis that he or she is a student. An unemployed individual may be considered to be able and available for work pursuant to subdivision (c) of Section 1253, if the school attendance does not eliminate a substantial portion of the individual's full-time labor market availability. If an unemployed individual restricts his or her availability to part-time work due to school attendance, he or she may be considered to be able to work and available for work if he or she meets the criteria set forth in Section 1253.8.</textarea>
                </div>
                <div class="sub-section">
                    <div class="sub-title">XML</div>
                    <textarea id="xmlText" placeholder="Enter XML representation here..."><statute id="1253.9"> <sectionHeading>Student unemployment compensation eligibility</sectionHeading> <provision num="1"> <rule type="non-disqualification"> <statement> An unemployed individual may not be disqualified for unemployment compensation benefits <condition type="solely">on the basis that he or she is a student</condition>. </statement> </rule> </provision> <provision num="2"> <rule type="eligibility_for_availability"> <statement> An unemployed individual may be considered to be able and available for work <pursuantTo> <citation ref="1253(c)">subdivision (c) of Section 1253</citation> </pursuantTo>, <condition type="if">the school attendance does not eliminate a substantial portion of the individual's full-time labor market availability</condition>. </statement> </rule> </provision> <provision num="3"> <rule type="conditional_eligibility_for_part_time_work"> <statement> <ifClause>If an unemployed individual restricts his or her availability to part-time work due to school attendance</ifClause>, <thenClause> he or she may be considered to be able to work and available for work <condition type="if">he or she meets the criteria set forth in <citation ref="1253.8">Section 1253.8</citation></condition>. </thenClause> </statement> </rule> </provision> </statute></textarea>
                </div>
            </div>
            <br>
            <button id="evaluateBtn" onclick="translateToXML()">Evaluate</button>
            <button id="clearBtn" onclick="clearInputs()">Clear</button>
        </div>
        <div class="output-section">
            <div class="section-title">Output</div>
            <textarea id="outputText" readonly placeholder="Evaluation results will appear here..."></textarea>
            <div id="errorDiv"></div>
        </div>
    </div>

    <script>
        async function translate(direction) {
            const legalText = document.getElementById('legalText').value;
            const xmlText = document.getElementById('xmlText').value;
            const inputText = legalText.trim() + '\n\n' + xmlText.trim();
            const outputText = document.getElementById('outputText');
            const errorDiv = document.getElementById('errorDiv');
            const buttons = document.querySelectorAll('button');

            errorDiv.innerHTML = '';
            if (!legalText.trim() || !xmlText.trim()) { showError('Please enter both legal text and XML code'); return; }

            outputText.value = 'Evaluating...';
            outputText.className = 'loading';
            buttons.forEach(btn => btn.disabled = true);

            try {
                const API_BASE_URL = window.location.hostname === 'afane.github.io'
                    ? 'https://lexa-production.up.railway.app'
                    : '';

                const response = await fetch(`${API_BASE_URL}/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: inputText, direction })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || 'Translation failed');

                let result = data.result;
                outputText.value = result;
                outputText.className = '';
                
                // Apply color coding to output - ONLY Summary section
                const outputDiv = document.createElement('div');
                let highlightedResult = result;
                
                // Color code ONLY Summary section based on content
                if (result.includes('Accurate representation') || result.includes('faithfully represents')) {
                    highlightedResult = highlightedResult.replace(
                        /(Summary:[\s\S]*?)$/g,
                        '<span class="summary-correct">$1</span>'
                    );
                } else if (result.includes('Contains discrepancies') || result.includes('issues') || result.includes('missing') || result.includes('incorrect')) {
                    highlightedResult = highlightedResult.replace(
                        /(Summary:[\s\S]*?)$/g,
                        '<span class="summary-issues">$1</span>'
                    );
                }
                
                outputDiv.innerHTML = highlightedResult;
                outputDiv.style.fontFamily = 'monospace';
                outputDiv.style.fontSize = '14px';
                outputDiv.style.padding = '10px';
                outputDiv.style.whiteSpace = 'pre-wrap';
                outputDiv.style.lineHeight = '1.4';
                outputText.style.display = 'none';
                outputText.parentNode.appendChild(outputDiv);
            } catch (error) {
                outputText.value = '';
                showError('Translation failed: ' + error.message);
            } finally {
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        function translateToXML() { translate('legal_to_xml'); }

        function clearInputs() {
            document.getElementById('legalText').value = '';
            document.getElementById('xmlText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('errorDiv').innerHTML = '';
            
            // Remove any HTML output div if it exists
            const existingOutputDiv = document.querySelector('.output-section div:not(#errorDiv):not(.section-title)');
            if (existingOutputDiv && existingOutputDiv.tagName === 'DIV' && existingOutputDiv.style.fontFamily === 'monospace') {
                existingOutputDiv.remove();
                document.getElementById('outputText').style.display = 'block';
            }
        }
    </script>
</body>
</html>
